@using APIInterface.Models.ResponseModels
@{
    ViewBag.Title = "SelectCar";
    Layout = null;
}


<!DOCTYPE html>
<html lang="en-US">
<head>
    <title>@Session["siteName"] &amp; @Session["siteTitle"]</title>
    <link rel="shortcut icon" type="image/x-icon" href="~/Images/images/favicon.ico" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="~/Content/css/jquery-ui.css" type="text/css" media="all" />
    <link rel="stylesheet" href="~/Content/css/style.css" type="text/css" media="all" />
    <link rel="stylesheet" href="~/Content/css/jquery.slider.min.css" />
    <!--[if IE]>
    <script type="text/javascript" src="~/Scripts/js/html5.js"></script>
    <link rel="stylesheet" id="stylesheet-ie" href="css/css_ie.css" type="text/css" media="all" />
    <![endif]-->
</head>
<body class="page page-two-column">
    <div id="conteiner">
        <div id="branding">
            <div id="branding-content">
                <div class="title-content">
                    <a  title=""><img class="site-logo" src="~/Images/images/thumb.png" alt="" /></a>
                    <h1 style=" width: 200%;" class="site-title"><a  title="">@Session["siteName"]</a></h1>
                </div>
                <div class="access-content">

                </div><!-- .access -->
                <div class="menus-content">
                    <div class="menus">
                        <div class="language">
                            <select class="select" name="select_language">
                                <option selected="selected">English</option>
                                <option>Arabic</option>
                            </select>
                        </div>

                    </div>

                </div>
            </div><!-- #branding-content -->
            <div class="clear"></div>
        </div><!-- #branding -->
        <div id="progress-bar">
            <div id="progress-bar-steps">
                <div class="progress-bar-step done">
                    <div class="step_number">1</div>
                    <div class="step_name">Create request</div>
                </div>
                <div class="progress-bar-step done">
                    <div class="step_number">2</div>
                    <div class="step_name">Choose a car</div>
                </div>
                <div class="progress-bar-step current">
                    <div class="step_number">3</div>
                    <div class="step_name">Choose extras</div>
                </div>
                <div class="progress-bar-step last">
                    <div class="step_number">4</div>
                    <div class="step_name">Review &amp; Book</div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
        <div id="main">
            <form class="main-form">
                <div id="book_car" class="title-form current">
                    @*<img src="~/Images/images/search.png" alt="" />*@
                    @*Search for a car:*@
                </div>
                <div id="book_car_content" class="content-form ">
                    <div class="location-block">
                        <div class="form-block location">Pick-up Location</div>
                        <input class="location" disabled type="text" value='@Session["pickupName"]' placeholder="Enter airport, city or zip code" name="location" />

                    </div>
                    <div class="form-block pick-up" style=" margin-left: 18px; width: 172px;">
                        <h4>Pick-up date</h4>
                        <input class="datepicker" disabled type="text" style="width: 70%" name="data_from" value='@Session["pickupDate"]' />
                        @*<input class="time-select" type="text" size="5"  name="time_from" />*@
                    </div>
                    <div class="form-block drop-off" style=" margin-left: 8px;">
                        <h4 style=" height: 18px;">Drop-off Location</h4>
                        <input class="location" style="    padding-top: 0px;height: 41px;" disabled type="text" value='@Session["dropoffName"]' placeholder="Enter airport, city or zip code" name="return_location" />
                        @*<input class="time-select" type="text" size="5"  name="time_to" />*@
                    </div>
                    <div class="form-block drop-off" style=" margin-left: 29px; width: 171px;">
                        <h4>Drop-off date</h4>
                        <input disabled class="datepicker" type="text" style="width: 70%" value='@Session["dropoffDate"]' name="data_to" value="" />
                        @*<input class="time-select" type="text" size="5"  name="time_to" />*@
                    </div>

                </div>
                <div class="clear"></div>
            </form>
            <div id="primary">
                <div class="clear"></div>
                <aside id="secondary" class="sidebar-left">
                    <div class="widget">
                        <h3 class="widget-title">
                            <img src="~/Images/images/order_info.png" alt="" />
                            Order Info
                        </h3>
                        <h4>
                            Car
                          
                        </h4>
                        <div class="widget-content main-block product-widget-mini">
                            <div class="product-img">
                                <img style="width: 105px;height: 55px" src="http://jfs24.com/data_images/reviews/toyota-corolla/toyota-corolla-02.jpg" alt="" />
                            </div>
                            @{
                                var hireGroup = (WebApiHireGroupDetailResponse)HttpContext.Current.Session["selectedHireGroupDetail"];
                            }
                            <div class="product-info">
                                <div class="entry-format">
                                    <div>@hireGroup.HireGroup</div>
                                    <span>@hireGroup.VehicleCategory</span>
                                </div>
                                <div class="features">
                                    <p title="Vehicle Maker"><img src="~/Images/images/passenger-icon.png" alt="" /><span>@hireGroup.VehicleMake</span></p>
                                    <p title="Vehicle Model"><img src="~/Images/images/transmission-icon.png" alt="" /><span>@hireGroup.VehicleModel</span> </p>
                                    <p title="Vehicle Model-Year"><img src="~/Images/images/km_l-icon.png" alt="" /><span>@hireGroup.ModelYear</span> </p>
                                    @*<p title="Tariff Type"><img src="~/Images/images/passenger-icon.png" alt="" /><span>@hireGroup.TariffType</span> </p>*@
                                    <p title="Charge" style="margin-left: 2px;"><img style="width: 8%" src="~/Images/images/currency.png" alt="" /><span id="standard_rate" style="margin-left: -4px">SAR @hireGroup.StandardRt</span>  </p>
                                </div>
                               
                            </div>
                        </div>
                       
                        <h4 class="extras">Extras</h4>
                        <div class="widget-content widget-extras" id="extras_Total_Sidebar">
                            <p id="defaultItem">No Extra Item Added!</p>
                        </div>
                        <div class="widget-footer widget-footer-total">
                            Total (SAR): <span class="price"></span><span id="overAllTotal"class="price"> @hireGroup.StandardRt</span>
                        </div>
                    </div>
                </aside>
                <div id="content" class="sidebar-middle">
                        <div class="widget main-widget product-widget main-widget-3column">
                            <div class="widget-title">
                                <div>
                                    <img src="~/Images/images/list.png" alt="" />
                                    Available Extras
                                </div>
                                <div class="clear"></div>
                            </div>
                      
                             @if (ViewBag.Data != null)
                            {
                                var extras = ViewBag.Data.ServiceItems;
                                foreach (var item in extras)
                                {
                                    <div class="post">
                                        <div class="checkbox-block_container">
                                            <div class="main-block_container">
                                                <div class="additional-block_container">
                                                    <div class="checkbox-block extra" id="@(item.ServiceTypeId)">
                                                        <input id="@("box_"+item.ServiceTypeId)" type="checkbox" class="styled" name="checkbox_extras" value="1" />
                                                    </div>
                                                    <div class="main-block">
                                                        <div class="product-img">
                                                            <img src="@item.ImageUrl" alt="" style="height: 80px;width: 80px;" />
                                                        </div>
                                                        <div class="product-info">
                                                            <h3 id="@("ItemName_"+item.ServiceTypeId)" class="entry-format">@item.ServiceTypeCode-@item.ServiceItemName</h3>
                                                            <div>@item.ServiceItemDescription</div>
                                                        </div>
                                                    </div>
                                                    <div class="additional-block">
                                                        <span id=@("currency_"+item.ServiceTypeId) hidden="">SAR </span>
                                                        <span id=@("rate_"+item.ServiceTypeId)>(Select Item)</span>
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clear"></div>
                                    </div>
                                } <!--extras loop ends-->
                            }   <!-- extras Null ends-->
                        </div>
                        <div class="widget main-widget product-widget main-widget-3column">
                            <div class="widget-title">
                                <div>
                                    <img src="~/Images/images/list.png" alt="" />
                                    Available Insurances
                                </div>
                                <div class="clear"></div>
                            </div>
                            @if (ViewBag.Data != null)
                            {
                                var insurances = ViewBag.Data.InsuranceTypes;
                                foreach (var item in insurances)
                                {
                                    <div class="post">
                                        <div class="checkbox-block_container">
                                            <div class="main-block_container">
                                                <div class="additional-block_container">
                                                    <div class="checkbox-block insurance" id="@(item.InsuranceTypeId)">
                                                        <input id="@("box_" + item.InsuranceTypeId)" type="checkbox" class="styled" name="checkbox_extras" value="1" />
                                                    </div>
                                                    <div class="main-block">
                                                        <div class="product-img">
                                                            <img src="@item.ImageUrl" alt="" style="height: 80px;width: 80px;" />
                                                        </div>
                                                        <div class="product-info">
                                                            <h3 id="@("ItemName_" + item.InsuranceTypeId)" class="entry-format">@item.InsuranceTypeCode-@item.InsuranceTypeName</h3>
                                                            <div>@item.InsuranceTypeDescription</div>
                                                        </div>
                                                    </div>
                                                    <div class="additional-block">
                                                        <span id=@("currency_" + item.InsuranceTypeId) hidden="">SAR</span>
                                                        <span id=@("rate_" +item.InsuranceTypeId)>(Select Item)</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clear"></div>
                                    </div>
                                } <!--extras loop ends-->
                            }   <!-- extras Null ends-->

                        </div>
                        @model APIInterface.Models.ExtrasIdsContainer
                        @{
                                               
                        }
                        @using (Html.BeginForm("Checkout", Session["CompanyShortName"]+"/Rental", FormMethod.Get, new { @class = "form-horizontal  custom-group", role = "form", id="temp" }))
                        {
                            <input type="hidden" name="ServiceItemsIds" id="ServiceItemsIds" value="shurmkro"/>
                            <input type="hidden" name="InsurancesIds" id="InsurancesIds" value="shurmkro" />
                            <div class="next_page" >
                                <input id="done" type="submit" class="continue_button blue_button" style="text-transform: uppercase; color: white; width: 173px;" @*onclick="location.href = '@Url.Action("Checkout", "Best/Rental")'"*@ value="Checkout" />
                            </div>
                        }
                       
                </div>
                <div class="clear"></div>
            </div>
        </div>
        <div class="clear"></div>
        <footer id="footer">
          
        </footer><!--end:footer-->
    </div><!--end:conteiner-->
    <div id="overlay_block"></div>
    
    <script type="text/javascript" src="~/Scripts/js/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="~/Scripts/js/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="~/Scripts/js/jquery-ui.js"></script>
    <!--[if IE]>
    <script type="text/javascript" src="~/Scripts/js/placeholder_ie.js"></script>
    <![endif]-->
    <script type="text/javascript" src="~/Scripts/js/jquery.slider.min.js"></script>
    <script type="text/javascript" src="~/Scripts/js/jquery.meio.mask.js"></script>
    <script type="text/javascript" src="~/Scripts/js/custom-form-elements.js"></script>
    <script type="text/javascript" src="~/Scripts/js/jquery.selectbox-0.2.min.js"></script>
    <script type="text/javascript" src="~/Scripts/js/script.js"></script>
    <script src="~/Scripts/_jquery.blockUI.js"></script>
    <script>
        var extrasList = new Array();
        var insurancesList = new Array();
       
        $("form").submit(function () {
            var index;
            var text = '-99';
            for (index = 0; index < extrasList.length; index++) {
                text = extrasList[index] + "," + text;
            }
            $("#ServiceItemsIds").val(text);
            text = '-99';
            for (index = 0; index < insurancesList.length; index++) {
                text = insurancesList[index] + "," + text;
            }
            $("#InsurancesIds").val(text);
        });
      function callInsurance() {
            var Id = this.id;
            if (document.getElementById("rate_" + Id).innerHTML != '(Select Item)') {
                var valueToMinus = document.getElementById("rate_" + Id).textContent;
                document.getElementById("rate_" + Id).innerHTML = '(Select Item)';
                $("#currency_" + Id).hide();
                
                var list = document.getElementById('extras_Total_Sidebar');
                var entryToBeRemoved = document.getElementById("ins_" + Id);
                list.removeChild(entryToBeRemoved);
                if ($("#extras_Total_Sidebar").children().length == 1) {
                    $('#defaultItem').show();
                }
                var prevTotal = parseInt(document.getElementById('overAllTotal').textContent);
                document.getElementById('overAllTotal').textContent = prevTotal - parseInt(valueToMinus);
                var index = insurancesList.indexOf(Id);
                if (index > -1) {
                    insurancesList.splice(index, 1);
                }
                return false;
            }
            hideUi();
            $.ajax({
                type: 'POST',
                data: "{'insuranceTypeId':'" + Id + "'}",
                contentType: "application/json; charset=utf-8",
                url: 'GetChargeForInsuranceType',
                dataType: 'json',
                success: function (response) {
                    if (response) {
                        document.getElementById("rate_" + Id).innerHTML = response.insuranceCharge.Charge;
                        list = document.getElementById('extras_Total_Sidebar');
                        var itemName = document.getElementById('ItemName_' + Id).textContent;
                        $("#currency_" + Id).show();
                        
                        var newdiv = document.createElement('p');
                        newdiv.setAttribute('id', 'ins_'+Id);
                        newdiv.innerHTML = itemName+ ' <span class="price">' + "SAR "+response.insuranceCharge.Charge + '</span>';
                        list.appendChild(newdiv);
                       
                        //  var newTotal =  response.itemCharge.ServiceCharge;
                        prevTotal = parseInt(document.getElementById('overAllTotal').textContent);
                        document.getElementById('overAllTotal').textContent = prevTotal + response.insuranceCharge.Charge;
                        insurancesList.push(Id);
                        
                        $('#defaultItem').hide();
                    }
                    else {

                    }
                    showUi();
                },
                error: function () {
                    showUi();
                },
            });
        }
        $(document).on('click', '.insurance', callInsurance);
       
        function callExtra() {
            var Id = this.id;
            if (document.getElementById("rate_" + Id).innerHTML != '(Select Item)') {
                var valueToMinus = document.getElementById("rate_" + Id).textContent;
                document.getElementById("rate_" + Id).innerHTML = '(Select Item)';
                $("#currency_" + Id).hide();
                
                var list = document.getElementById('extras_Total_Sidebar');
                var entryToBeRemoved = document.getElementById("exs_" + Id);
                list.removeChild(entryToBeRemoved);
                if ($("#extras_Total_Sidebar").children().length == 1) {
                    $('#defaultItem').show();
                }
                var prevTotal = parseInt(document.getElementById('overAllTotal').textContent);
                document.getElementById('overAllTotal').textContent = prevTotal - parseInt(valueToMinus);
                var index = extrasList.indexOf(Id);
                if (index > -1) {
                    extrasList.splice(index, 1);
                }
                return false;
            }
            hideUi();
            $.ajax({
                type: 'POST',
                data: "{'serviceItemId':'" + Id + "','quantity':'1'}",
                contentType: "application/json; charset=utf-8",
                url: 'GetChargeForServiceItem',
                dataType: 'json',
                success: function (response) {
                    if (response) {
                        document.getElementById("rate_" + Id).innerHTML = response.itemCharge.ServiceCharge;
                        list = document.getElementById('extras_Total_Sidebar');
                        var itemName = document.getElementById('ItemName_' + Id).textContent;
                        $("#currency_" + Id).show();
                        
                        var newdiv = document.createElement('p');
                        newdiv.setAttribute('id', 'exs_'+Id);
                        newdiv.innerHTML = itemName+ ' <span class="price">'+"SAR " + response.itemCharge.ServiceCharge + '</span>';
                        list.appendChild(newdiv);
                       
                        //  var newTotal =  response.itemCharge.ServiceCharge;
                        var prevTotal = parseInt(document.getElementById('overAllTotal').textContent);
                        document.getElementById('overAllTotal').textContent = prevTotal + response.itemCharge.ServiceCharge;
                         extrasList.push(Id);
                        
                        $('#defaultItem').hide();
                    }
                    else {

                    }
                    showUi();
                },
                error: function () {
                    showUi();
                },
            });
        }
        $(document).on('click', '.extra', callExtra);
        
        function moveToCheckout() {
            var total = parseInt(document.getElementById('overAllTotal').textContent);
            
            $.ajax({
                url: "Checkout?total=" + 5,
                type: 'GET',
                error: function (xhr, ajaxOptions, thrownError) {
                    alert(xhr.status);
                    alert(thrownError);
                }
            });
        
            //$.ajax({
            //    type: 'GET',
            //    data: "{'total':'" + total + "','extras':'" + extrasList + "'}",
            //    contentType: "application/json; charset=utf-8",
            //    url: 'Checkout',
            //    dataType: 'json',
            //    success: function (response) {
            //        if (response) {
                       
            //        }
            //        else {
            //            alert('failed');
            //        }
            //    },
            //    error: function (aaa,aaaf,dfdf) {
            //        alert('failed');
            //    },
            //});
        }
     
    </script>
</body>
</html>